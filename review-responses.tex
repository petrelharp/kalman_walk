%%%%%%
%%
%%  Don't reorder the reviewer points; that'll mess up the automatic referencing!
%%
%%%%%

\begin{minipage}[b]{2.5in}
  Resubmission Cover Letter \\
  {\it Evolution}
\end{minipage}
\hfill
\begin{minipage}[b]{2.5in}
    Joshua Schiffman \\
    \emph{and} Peter Ralph \\
  \today
\end{minipage}
 
\vskip 2em
 
\noindent
{\bf To the Editor(s) -- }
 
\vskip 1em

We are pleased to submit a revision of our manuscript, 

\noindent \hspace{4em}
\begin{minipage}{3in}
\noindent
{\bf Sincerely,}

\vskip 2em

{\bf 
Joshua Schiffman and
Peter Ralph
}\\
\end{minipage}

\vskip 4em

\pagebreak

%%%%%%%%%%%%%%
\reviewersection{AE}

\begin{quote}
I have received the evaluations of two reviewers, and I have read the paper
myself. First, sorry for the long time it took to review your manuscript; it
was reviewed on the timescale of mathematicians (for Reviewer2), but both
reviewers provided thorough evaluations of your work (which in my opinion is
better than a quick but superficial review).

Your manuscript is quite long already, and the reviewers' suggestions of
modifications and clarification, which need to be implemented, will make the
manuscript even longer. I however share the reviewers' opinion that the
manuscript's two parts are only loosely related. My suggestion is therefore to
publish them separately. Although connecting the systems biology and the
quantitative genetics parts is indeed an exciting endeavor, this is not really
achieved in the current version of the manuscript, and it would be more
profitable to first better describe each part separately. Regarding the
connexion between the two parts, please also pay particular attention to R2's
first specific comment about dimensionality.

This may be because I am more familiar with Fisher's geometric model than
systems biology models, but it seems to me that the first part is more novel,
and should therefore deserve your attention first, should you follow my
suggestion of publishing the two parts separately.
\end{quote}


\begin{point}{Format:}
    Please add line numbers to your manuscript; it is straightforward
with the lineno package in LaTeX.  Please also do not increase text width too
much, as this decreases legibility (LaTeX's default settings already optimize
the number of characters per line).  Finally, be careful about not confusing
citep and citet (a lot of missing parentheses around citations in the second part).
\end{point}

\reply{
  We've added line numbers and corrected improperly formatted citations. 
}

\begin{point}{all figures:}
    Please ensure that all axes legends and labels are big enough
and not distorted (same of arrow labels on the diagrams). Please also make sure
that the lines are thick enough to be visible.
\end{point}

\reply{
}

\begin{point}{Above eq (2):}
    ``Under quite general assumptions'': quickly mention them?
\end{point}

\reply{
  Thank you for the suggestion. We now mention some \revref.
  \jss{I think the general assumptions are time invariance and linearity? Any others we should mention?}
}

\begin{point}{eq (2):} 
    Do you need the first term on the rhs given that you assume that $\kappa(0)=0$?
\end{point}

\reply{
    Ah, good point. We've removed it. \revref
}

\begin{point}{Example 1:}
    ``and so its phenotype'' whose phenotype? (the subject of the sentence is ``the input'')
\end{point}

\reply{
    Fixed. \revref
}

\begin{point}{p5, Note on implementation}
    ``the closure of span(B)'' may not be
    understandable by most of Evolution's readers; please explain what this means.
\end{point}

\reply{
    We've added a clarifying note \revref
    but we're hoping that readers not familiar with linear algebra will realize
    that they can skip this ``note on implementation'' without loss of continuity.
}

\begin{point}{Figures 1-3:}
    In figures 1 and 3, there are two types of arrow heads (+ and -
effects), but not in Figure 2, probably because the sign of the effect depends
on the value of $\tau$. Maybe use a  different type of arrow heads for
interactions that may change signs, to avoid the confusion with positive
effects?
\end{point}

\reply{
  We think that adding a third type of arrowhead may only add to the confusion, so now we are using only the standard arrowhead \revref.
  \jss{we could add a cirlce arrowhead for the unknown direction, but I think its simpler to just get rid of the rectangular negative arrowhead originally in Figure 3}
}

\begin{point}{p7, Hybrid incompatibility:}
    Please provide a rationale for choosing a particular weight $\rho$.
\end{point}

\reply{
    Good suggestion; added. \revref
}

\begin{point}{p11, 2nd paragraph}
    Try to better relate these different studies to yours
(e.g., what you add, what they do and you do not). In addition to R1's
suggestions, consider \citet{weinreich2013fishers} and \citet{blanquart2016epistasis}.
% Weinreich, D. M. and Knies, J. L. (2013), FISHER'S GEOMETRIC MODEL OF ADAPTATION MEETS THE FUNCTIONAL SYNTHESIS: DATA ON PAIRWISE EPISTASIS FOR FITNESS YIELDS INSIGHTS INTO THE SHAPE AND SIZE OF PHENOTYPE SPACE. Evolution, 67: 2957-2972. doi:10.1111/evo.12156
% François Blanquart and Thomas Bataillon Epistasis and the Structure of Fitness Landscapes: Are Experimental Fitness Landscapes Compatible with Fisher’s Geometric Model?  GENETICS Early online April 6, 2016
\end{point}

\reply{
    This part has been removed.
}

\begin{point}{p12 Hybridization:}
    What is $\mathcal{X}$?
\end{point}

\reply{
    This part has been removed.
}

\begin{point}{p15}
    ``The importance of including neutral directions in these models, which
is not usually done'' -- Do not line of isofitness correspond to neutral
directions, and aren't these neutral directions already included in those
models?
\end{point}

\reply{
    This part has been removed.
}



%%%%%%%%%%%%%%
\reviewersection{1}

\begin{quote}
The ms combines two parts that are only loosely linked: one ``systems biology''
part and a ``popgen'' part. The combination of both parts is appealing, primarily
because we lack such combined approaches and it is not easy to come up with an
adequate framework. Below, I will discuss both parts in turn.
\end{quote}

\begin{quote}
General remark: line numbers are very helpful for reviewing.  
\end{quote}

\begin{quote}
    \textbf{(I)} The first (systems biology) part makes use of the concept of
``nonidentifiability'' of chemical reaction networks and develops these concepts
in the context of a genotype to phenotype map. In particular, this map is
analyzed for the case where it can be modeled as a linear system.
\end{quote}

\begin{point}{}
    First note that the concept of ``nonidentifiability'' is closely related to
themes that have been discussed in evolutionary biology for a long time, under
names like ``mutational robustness'', ``network neutrality'', ``canalization'',
``redundancy'' etc. In particular, if you characterize your model by ``many
distinct (and mutationally connected) molecular pathways can realize identical
phenotypes'', note that this essentially describes what has been called a
``neutral network'' and studied under this name in many articles. Also concrete
developmental networks have been studied in this context (eg, von Dassow etal
2000, Nature 406:188–192). Discussion of this literature - and more importantly
discussion of terms and notions used here relative to terms that have been used
elsewhere - is largely missing. I won't be able to summarize all this here, but
an older review is the Evolution Perspective piece ``Evolution and detection of
genetic robustness'' (de Visser et al 2003). You can work work backward and
forward from there.  
\end{point}

\reply{
  We've reworked the introduction and included a paragraph on the phenonmenon of biological degeneracy, which unites many of these concepts. \revref
}

\begin{point}{}
    Related to this: I find it non-intuitive to start the introduction with the
notion of ``nonidentifiability'', which is a consequence rather than a cause, the
cause being what you later call ``phenotypic equivalence'' and what had been
discussed under other names in other articles.
\end{point}

\reply{
  Good point. In the introdcution we now introduce nonidentifiability after discussing general cases of phenotypic equivalence. \revref
}

\begin{point}{}
    Still related: You give long lists of references in the introduction, but do
not provide the reader with any information about specific contributions. A bit
more would be helpful (starting with True and Haag coined the term
``developmental system drift'', etc).
\end{point}

\reply{
  We've reworked the introduction and included more detail about these references. \revref
}

\begin{point}{4.}
    Your ms does not simply assume that there is a large ``neutral network''
underlying a phenotype, but suggests a mechanistic underpinning to create this
neutral space. Since much of the appeal of the first part of the paper is
connected to this fact, I'd like to see some more in-depth discussion.
\textit{(suggestions to follow)}
\end{point}

\reply{
}

\begin{point}{(mechanistic models)}
    You should probably mention somewhere that mechanistic models of neutral
  spaces exist in the (quite different) context of RNA folding (papers by Hofacker, Fontana, etal)
\end{point}

\reply{
  Added \revref.
}

\begin{point}{(mechanistic models)}
    For development, Andreas Wagner once suggested a discrete version of a linear
  model (iterated matrix multiplication). Variants of this have later been used
by others (eg Draghi and GP Wagner, I think). How is your model related to
these approaches?
\end{point}

\reply{
}

\begin{point}{(mechanistic models)}
    You model development as a linear system and this assumption is essential
   for all further steps (the explicit solution of the dynamics and the Kalman
decomposition). For me, the only justification of a linear model (other than
mathematical convenience) is local approximation. Do you agree? This will be
important for the second part of the ms, see below.
\end{point}

\reply{
}

\begin{point}{(mechanistic models)}
    You gain a lot of ``neutrality'' by the assumption that the dimension of the
  ``krypotype'' is larger than the dimension of the trait. If the trait is the
expression of a gene at the top of some pathway, this is certainly true.
However, if we include further traits that are affected by the same genes
(i.e., pleiotropy) this is no longer clear. The space of ``all traits under
selection'' of an organism is awfully high-dimensional and pleiotropy is
wide-spread (even if we do not believe in ``omnigenic'' models). It is not clear
to me from what kind of data we could learn more about these dimensions and I
do not expect an answer in your ms, but the issue deserves more discussion.
Currently, ``pleiotropy'' is not even mentioned in the ms.   
\end{point}

\reply{
    We have added discussion of this in the Discussion. \revref
}


\begin{point}{Introduction:}
    ``Genotypes encoding identical phenotypes can even persist stably within a species'' - if there is population structure, I suppose.
\end{point}

\reply{
    Yes, that's right. \revref
}

\begin{point}{Introduction:}
    ``It is not a new observation that there is often more than one way to do the same thing, and that this may lead to speciation'' - Isn't this what people would call a neutral Dobzhansky-Muller incompatibility?
\end{point}

\reply{
}

\begin{point}{Results:}
    (Eq. 1) development as a linear system: has this been done before (probably yes?) - If so, references?
\end{point}

\reply{
}

\begin{point}{Results:}
    ``Of course, neither of these are necessarily true for real systems'' - delete ``necessarily''?
\end{point}

\reply{
    This sentence has been removed.
}

\begin{point}{Eq. 3:}
    What does a coordinate change mean biologically? In our JC, we discussed for a while whether this is just a different parametrization of the exact same biological thing (like transformation to principle components). I think I now understand that it is more, but this should be explained better.
\end{point}

\reply{
    Biologically, a coordinate change may produce an unrecognizably different system
    (repression changed to activation or the like);
    we've added a hopefully clarifying sentence. \revref
}

\begin{point}{}
    ``Since gene networks can grow or shrink following gene duplications and deletions,
these additional degrees of freedom can apply in principle to any system.'' - are there examples of equivalent gene networks with a different size due to gene duplication or loss?
\end{point}

\reply{
}

\begin{point}{Kalman decomposition:}
    Define the sub-matrices directly when first used.
\end{point}

\reply{
    Good point; we now say ``in block matrix form'' and add more explanation. \revref
}

\begin{point}{Figure 2:}
    Colors are hardly visible
\end{point}

\reply{
}

\begin{quote}
    \textbf{(II)} The popgen part. This part models the ``system drift'', which is nothing else
but neutral drift of a population along a high-fitness ridge in an epistatic
landscape (conceptual figure 4), right? If two populations in allopatry drift
in different directions, this can lead to hybrid incompatibilities, which are
uncovered upon secondary contact. Fitness is modeled by the weighted distance
from the optimal impulse response function (eq 5). This is a natural
assumption.
\end{quote}

\reply{
    \plr{I'm leaving these points because they might apply to whatever handwaving 
    we replace the quant gen stuff with.}
}

\begin{point}{}
    Your analysis of the fitness loss in F1 and F2 hybrids rests on a local
Taylor expansion of the fitness landscape. This is adequate given that the
underlying linear network is also only locally valid (see above). However, you
then apply this to a discussion of hybrid incompatibility (Haldane's rule etc).
We are thus interested in *very large* fitness costs for hybrids. This does not
seems to be compatible: to get hybrid incompatibility or sterility, you need to
have epsilon sufficiently large (below equation 5). But then $\epsilon^2$ is no
longer smaller than epsilon. In other words: it seems to me that for the
discussion of hybrid incompatibilities you apply your model of the first part
beyond the local range where it is valid.
\end{point}

\reply{
}

\begin{point}{}
    For system drift, you assume that ``Selection will tend to restrain this
motion, but movement along the optimal set N is unconstrained, and so we expect
the population mean to drift along the optimal set like a particle diffusing.''
I see two major problems with this view. Both lead to slower divergence and
therefore run against your conclusions.
    \textit{(further points to follow)}
\end{point}

\reply{
}

\begin{point}{(drift along a ridge)}
    In the presence of epistasis, evolution on a neutral network (a high-fitness
  ridge) is *not* due to drift alone, but also affected by (weak second order)
selection in favor of mutational robustness / genetic canalization. In contrast
to what you write, diffusion on the set of network coefficients corresponding
to the optimal phenotype is not unbiased - even if the optimal phenotypes do
indeed all have the same fitness. Instead, selection drives the population to
``thicker'' parts of the network where the mean fitness of the population
(including a cloud of mutants) is higher that on a narrow ridge. This is the
basis of the evolution of robustness/canalization. It is possible to account
for this effect, see Hermisson et al 2003. Amer. Nat. 161, 708-734;
Alvarez-Castro et al, TPB 75 (2009) 109-122, or also Rice, 1998, Evolution 52,
647-656; van Nimwegen, etal 1999, PNAS 96:9716–9720. Note that epistasis is
necessary for the neutral evolution of incompatibilities, which is what you are
aiming for.
\end{point}

\reply{
}

\begin{point}{(drift along a ridge)}
    a second problem results from the fact that evolution on a high-fitness ridge
  often requires coordinated changes at many loci. Take the oscillator system
that you use as an example: simultaneous changes at two genes are required to
maintain the phenotype. This leads to a phenomenon called ``adaptive inertia''
(see Baatz and Wagner, TPB 51, 49-66 and Alvarez-Castro etal . TPB 75, 109-122),
which effectively slows down the movement along the ridge considerably. This
problem applies, in particular, in a ``house-of-cards'' mutation regime when
where rarely two mutations occur together on the same haplotype. In small
populations, it typically requires that populations drift through shallow
fitness valleys. While this is possible, it slows down the process.  
\end{point}

\reply{
}

\begin{point}{(drift along a ridge)}
    The relevance of both effects could be studied by simulations in a simple
example (eg the oscillator that is used as an illustration in the ms anyway).
\end{point}

\reply{
}

\begin{point}{}
    If speciation due to accumulation of incompatibilities does not occur in
allopatry, but under (even weak) gene flow, some degree of positive selection
is always needed (Bank et al, Genetics 191, 845–863 for a proof). This also
means that even weak gene flow will counteract the process described in the ms.
\end{point}

\reply{
}

\begin{point}{}
    Population isolates and genetic load: Isn't this exactly ``founder effect
speciation''?
\end{point}

\reply{
}

\begin{point}{}
    Your analysis of the fitness loss in F1 and F2 hybrids rests on a local
Taylor expansion of the fitness landscape. This is adequate given that the
underlying linear network is also only locally valid (see above). However, you
then apply this to a discussion of hybrid incompatibility (Haldane's rule etc).
We are thus interested in \emph{very large} fitness costs for hybrids. This does not
seems to be compatible: to get hybrid incompatibility or sterility, you need to
have epsilon sufficiently large (below equation 5). But then $\epsilon^2$ is no
longer smaller than $\epsilon$. In other words: it seems to me that for the
discussion of hybrid incompatibilities you apply your model of the first part
beyond the local range where it is valid.
\end{point}

\reply{
    That's a good point; we resort to a Taylor expansion 
    because we couldn't think of any other clear way to get quantitative estimates.
    However, our simulations XXX.
}


%%%%%%%%%%%%%%
\reviewersection{2}

\begin{quote}
The present paper is divided into two parts. In the first part, the authors propose a framework
in which distinct genetic architectures can produce the same phenotype. (In the fitness landscape
terminology, this would correspond to the existence of an evolutionary ridge in a fitness landscape.
)The starting point is a nice analogy with linear systems theory. The authors highlight the fact
that in general, two distinct linear (differential) systems can respond identically for any input; i.e.,
different systems (genotypes) can always produce the same output (phenotype) given the same input
(environment). Further, the set of equivalent systems can be nicely characterized through Kalman
decomposition, thus providing a nice characterization of level sets in the underlying fitness landscape.
All along the first part of the paper, this analogy is well illustrated using a simple (yet quite nice)
example of oscillating gene transcription. I especially like Fig. 5 where it is shown that even if $F_1$
hybrids have a phenotypic response close to their parents, $F_2$ hybrids can behave in a drastically
different manner.

In the second part of the paper, motivated by the previous results, the authors explore a general
quantitative genetics model in which populations can drift stochastically near a set of equivalent
and optimal systems. Since the optimal set (or evolutionary ridge) is not closed under averaging or
recombination, two isolated populations can drift apart and accumulate enough genetic differences
so that they do not produce any viable offspring. Using some heuristics, several expressions are
derived to quantify the accumulation of genetic incompatibilities.

Overall, I think the paper is well written. The framework developed in the first part of the paper
is very interesting and that the analogy with system theory is quite enlightening. I am somehow
less convinced by the second part. First, I find the arguments a bit sketchy (see below) and not so
easy to follow. Secondly, it is not entirely clear to me what is the main contribution of this part
compared to previous works. It seems to me that the main result is somehow contains in the fact
that the variance (or ``segregation variance'') of an $F_2$ population is given by
$$\sigma^2_S + 4 \omega \sigma^2_N T / N_e$$
which was already derived Slatkin and Lande according to the authors (except for the explicit
expression of $\omega$, but again I am a little bit confused by the arguments derived in the appendix).

In summary, I think this paper could be a nice contribution to Evolution. However, I am also
convinced that the second part of the paper would require more work, or more explicit reference
to previous works (equation, section etc.) if the authors do not want to re-derive already existing
formula.
\end{quote}


\begin{point}{end of p6:} 
    ``we assume ... $((A + A' )/2, (B + B' )/2, (C + C' )/2)$'' . It is claimed in p4 (right
before the last paragraph) that two kryptotypes need not have the same dimension. In this
case, the previous sum does not make sense, right?
\end{point}

\reply{
    Good point; added that caveat. \revref
}

\begin{point}{p7: fig 4.}
    ``The distribution of $F_2$ ... homozygotes''. I do not really grasp the meaning of this
sentence. More importantly, I find the purple cloud of dots ($F_2$ population) quite confusing.
It seems to me that the purple populations should be a cloud of points concentrated around
a point sitting on the red dotted line, i.e., a Gaussian distribution with the mean at the
average of the two parental populations. According to the authors, the distribution is bi-
modal with a peak below the optimal set (as displayed on the figure) and another distinct
peak sitting on the other side of the optimal. In fact, if I understand the computations of
the second part correctly, the red and purple means should coincide, but the red variance
should simply be greater.
\end{point}

\reply{
    XXX Suggestion: change this figure to have two figures of the same type, side-by-side,
    one with a simple genetic basis (like this one, but with two purple clouds)
    and another with a more quantitative trait.
}

\begin{point}{p7: end of the page.}
    Why do you need $\rho$ to be square integrable?
\end{point}

\reply{
    Good point -- clearly some assumptions jointly on the long-time behavior of $h(t)$ and $\rho$ 
    are required for $D$ to be finite, but just saying that $\rho$ is square integrable doesn't suffice;
    we've removed the caveat. 
    \revref
    (It is always well-defined, anyhow, since the integrand is nonnegative.)
}

\begin{point}{p8:}
    ``A Taylor expansion of $D(h_\epsilon)$ .. ''. It is not clear to me at all. Could you provide some
extra explanation (e.g., in the appendix)?
\end{point}

\reply{
    We have put back in the somewhat lengthy Appendix on this subject 
    that we'd removed before submission. \revref
    XXX TODO EDIT THAT APPENDIX XXX
}

\begin{point}{p9. Fig 5.} 
    In the left panel, it seems to me that the two parents are homozygotes since there
is a single $F_1$ possible offspring (dashed blue curve). It would be worth being more explicit.
For the right panels, could you be more explicit on the number of curves. If I understand
correctly, there are 16 possibilities due to recombination (2 per entries of the matrix) since
$F_1$ individuals are heterozygotes. Is that correct?
Finally, the labels on the y axis are not easy to read.
\end{point}

\reply{
    We've added ``homozygous'' to the caption,
    and mentioned that there are $3^4 = 81$ possible $F_2$s -- 
    this is because it only matters if, at each of the four matrix entries, 
    the offspring is heterozygous, homozygous for parent 1, or homozygous for parent 2.
}

\begin{point}{p11. Paragraph system drift.}
    ``move a random distance $\sigma$''. What is $\sigma$? I think it should
be $\sigma_N$ (the std deviation in the direction of the evolutionary ridge) to be consistent with
the assumption that the population drifts along the optimal set. I believe that this is what
is assumed thereafter. Also, the sentence ``It therefore seems .... as cloud of points of width
$\sigma$'' is not very accurate, since the covariance matrix is not the identity.
\end{point}

\reply{
    This part has been removed.
}

\begin{point}{p 11.}
    Approximating the optimal set $\mathcal{N}$ by a quadratic surface should only be accurate if
we look at the genetic divergence at small time scales. This should be at least mentioned.
\end{point}

\reply{
    This part has been removed.
}

\begin{point}{end of p11.}
    $1/( \frac{d}{du} D(x + uz))$ should be evaluated at $u = 0$.
\end{point}

\reply{
    This part has been removed.
}

\begin{point}{p12. Third paragraph}
    $\sqrt{4 \omega T/N_e} \sim \gamma/\sigma_N$.
    I guess the underlying assumption here is that
    $\sigma_S \ll \sqrt{4 \omega \sigma^2_N T/N_e}$?
\end{point}

\reply{
    This part has been removed.
}

\begin{point}{p12. before eq. 7.}
    $\mu = c_\mu \gamma T /N_e$. Why is $\mu$ proportional to $\gamma$?
\end{point}

\reply{
    This part has been removed.
}

\begin{point}{Fig 7.}
    I have one important issue with this figure (and the assumptions of the underly-
ing quantitative genetic model). If one wants to be consistent with the assumption that
parental populations drift along the evolutionary ridge, I think one would need to assume
that selection is strong enough to constraint the mean of the population on the surface. This
would presumably require that $\sigma S /\gamma \ll 1$. First, I think this assumption (or something
alternative to that) should be made explicit in the text. Secondly, it seems to me that this
assumption is not satisfied for panel A and C: under the range of parameters proposed by
the authors, the parental populations could easily drift away from the optimal set, and in
particular, the heuristics derived in the main text would not be satisfied.
\end{point}

\reply{
    This part has been removed.
}

\begin{point}{}
    Finally, it would be worth mentioning several old and recent works relating genetic drift
to speciation: Yamagushi and Iwasa, several articles by Gavrilets et al. (I think several
citations are missing here), and Mirò Pina and Schertzer.
\end{point}

\reply{
  \citep{yamaguchi2013first,pina2019does}
}



